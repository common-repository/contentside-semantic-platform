!function(){"use strict";var t={n:function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,{a:n}),n},d:function(e,n){for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}},e=window.wp.apiFetch,n=t.n(e),r=[],o=null,a={getSettings:function(){return n()({path:"/csp-plugin/v1/settings",method:"GET"})},isApiKeyValid:function(){return null!==o?Promise.resolve(o):n()({path:"/csp-plugin/v1/settings",method:"GET"}).then((function(t){return o=t&&t.is_api_key_valid&&"true"===t.is_api_key_valid,r=t.allowed_features,a}))},isFeatureAllowed:function(t){return r.length>0?Promise.resolve(r.includes(t)):n()({path:"/csp-plugin/v1/settings",method:"GET"}).then((function(e){return(r=e.allowed_features).includes(t)}))}},__=wp.i18n.__,i=jQuery,c={bindEvents:function(){var t=document.querySelector(".csp-plugin-start-transaction-button");t&&t.addEventListener("click",c.clickHandle),document.querySelector("#csp-plugin_sync_progress")&&setInterval((function(){c.followSynchronization()}),1e4)},followSynchronization:function(){n()({path:"/csp-plugin/v1/related-posts/nb-already-synced",method:"GET"}).then((function(t){document.querySelector("#csp-plugin_sync_total").getAttribute("value")===t.nbPostSynced&&c.markSyncAsDone()})).catch((function(t){console.error(t)}))},markSyncAsDone:function(){var t=__("Done","csp-plugin");i("#csp-plugin-start-sync-button").html(t).attr("disabled",!0).attr("style","background-color: #4CAF50 !important; color: white !important")},clickHandle:function(t){var e=t.target;t.preventDefault();var n=e.getAttribute("data-ajaxurl"),r={action:e.getAttribute("data-action"),nonce:e.getAttribute("data-nonce")};i("#csp-plugin_setting_related_posts_sync_last_sync_date").val((new Date).toISOString().slice(0,19).replace("T"," ")),fetch(n,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache"},body:new URLSearchParams(r)}).then((function(t){return t.json()})).then((function(t){if(!t.success)throw alert(__("An error occurred and the synchronization could not start","csp-plugin")),new Error("Response content : ".concat(t.data));return t.data})).then((function(){var t=document.querySelector("#csp-plugin_sync_total").getAttribute("value");document.querySelector("#csp-plugin-sync-info").parentNode.removeChild(document.querySelector("#csp-plugin-sync-info"));var e=__("Loading...","csp-plugin");i("#csp-plugin-start-sync-button").html(e).attr("disabled",!0),setTimeout((function(){c.markSyncAsDone()}),2e3*t)})).catch((function(t){return console.error(t)}))}},l=c,u=wp.i18n.__,s={bindEvents:function(){var t=document.querySelectorAll(".csp-plugin-related-posts-meta-box-action-button");t&&t.forEach((function(t){t.addEventListener("click",s.handleActionButtonClick)}));var e=document.querySelectorAll("[id^='csp-plugin-remove-related-post-button']");e&&e.forEach((function(t){t.addEventListener("click",s.removeRelatedPost)}))},addSpinner:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=document.createElement("div");return n.className="spinner csp-plugin-spinner",t.after(n),e&&t.parentElement.removeChild(t),n},handleActionButtonClick:function(t){var e=t.target;t.preventDefault();var n=s.addSpinner(e),r=e.getAttribute("data-ajaxurl"),o={action:e.getAttribute("data-action"),nonce:e.getAttribute("data-nonce"),postId:e.getAttribute("data-postId")};fetch(r,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache"},body:new URLSearchParams(o)}).then((function(t){return t.json()})).then((function(t){if(n.parentNode.removeChild(n),!t.success)throw alert(u("An error occurred.","csp-plugin")),new Error("Response content : ".concat(t.data));return t.data})).then((function(t){s.replaceRelatedPostsTableContent(t)})).catch((function(t){alert(u("An error occurred.","csp-plugin")),console.error(t),n.parentNode.removeChild(n)}))},removeRelatedPost:function(t){var e=t.target;t.preventDefault();var n=s.addSpinner(e,!0),r=e.getAttribute("data-ajaxurl"),o={action:e.getAttribute("data-action"),nonce:e.getAttribute("data-nonce"),postId:e.getAttribute("data-postId"),relatedPost:e.getAttribute("data-relatedPost")};fetch(r,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache"},body:new URLSearchParams(o)}).then((function(t){return t.json()})).then((function(t){if(n.parentNode.removeChild(n),!t.success)throw n.parentNode.removeChild(n),alert(u("An error occurred.","csp-plugin")),new Error("Response content : ".concat(t.data));return t.data})).then((function(t){s.replaceRelatedPostsTableContent(t)})).catch((function(t){alert(u("An error occurred.","csp-plugin")),console.error(t),n.parentNode.removeChild(n)}))},replaceRelatedPostsTableContent:function(t){document.querySelector("#csp-plugin-related-posts-meta-box > .inside").innerHTML=t.metaBoxContent,s.bindEvents()}},f=s,p=window.wp.richText,d=window.wp.components,h=window.wp.element,m=window.wp.i18n,y=function(t){var e=t.isLoading,n=t.posts,r=t.value,o=t.onChange,a=t.setOpen,i=t.permalinks;return React.createElement("div",{className:"csp-plugin-modal-result-table-container"},React.createElement("table",{className:"wp-list-table widefat fixed pages sortable "},e&&React.createElement("tr",null,React.createElement("td",{style:{textAlign:"center"}},React.createElement(d.Spinner,null))),!e&&n.length>0?n.map((function(t){return React.createElement("tr",null,React.createElement("td",null,React.createElement("strong",null,t.post_title),React.createElement(d.Button,{className:"float-right",onClick:function(){return function(t){a(!1),o((0,p.toggleFormat)(r,{type:"csp-plugin/link-to-related-post",attributes:{href:i[t.ID]}}))}(t)},variant:"primary"},(0,m.__)("Select","csp-plugin"))))})):e?React.createElement(React.Fragment,null):React.createElement("tr",null,React.createElement("td",null,React.createElement("span",null,(0,m.__)("No result","csp-plugin"))))))},g=window.React,v=window.wp.data,b=function(t){return n()({path:"/csp-plugin/v1/related-posts",method:"POST",data:t})},w=function(t,e){return""!==t.attributes.content?t.attributes.content:e};function E(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,_x,a,i=[],_n=!0,c=!1;try{if(_x=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;_n=!1}else for(;!(_n=(r=_x.call(n)).done)&&(i.push(r.value),i.length!==e);_n=!0);}catch(t){c=!0,o=t}finally{try{if(!_n&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return S(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?S(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var _=function(t){var e=t.open,n=t.setOpen,r=t.value,o=t.onChange,a=t.selectedText,i=function(){return n(!1)},c=E((0,h.useState)(!0),2),l=c[0],u=c[1],s=E((0,h.useState)([]),2),f=s[0],p=s[1],S=E((0,h.useState)([]),2),_=S[0],R=S[1],x=(0,v.useSelect)((function(t){return t("core/block-editor").getSelectedBlock()}),[]);return(0,g.useEffect)((function(){if(e){var t=wp.data.select("core/editor").getCurrentPost(),r={postId:wp.data.select("core/editor").getCurrentPostId(),content:w(x,a),introduction:""!==t.excerpt?t.excerpt:t.title,title:t.title};if(function(t){var e=["title","content","introduction"].filter((function(e){return!t[e]||""===t[e]}));return!(e.length>0)||e}(r).length>0)return void n(!1);b(r).then((function(t){p(t.posts),R(t.permalinks),u(!1)})).catch((function(t){console.error(t),u(!1)}))}}),[e]),React.createElement(React.Fragment,null,e&&React.createElement(d.Modal,{className:"csp-plugin-related-posts-modal",title:(0,m.__)("Choose the related post","csp-plugin"),onRequestClose:i},React.createElement(y,{isLoading:l,posts:f,value:r,onChange:o,setOpen:n,permalinks:_}),React.createElement(d.Button,{className:"csp-plugin-related-posts-modal-button",variant:"secondary",onClick:i},(0,m.__)("Cancel","csp-plugin")),React.createElement(d.Button,{className:"csp-plugin-related-posts-modal-button",variant:"primary",onClick:i},(0,m.__)("Save","csp-plugin"))))},R=window.wp.blockEditor;function x(t){return x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},x(t)}function O(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==x(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==x(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(r.key),"symbol"===x(o)?o:String(o)),r)}var o}var A=new(function(){function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.cachedCapabilities=null,this.currentPromise=null,setInterval((function(){e.cachedCapabilities=null}),1e4)}var e,n;return e=t,(n=[{key:"resetCurrentPromise",value:function(){this.currentPromise=null}}])&&O(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}()),P={isCurrentUserAllowedTo:function(t){if(null!==A.currentPromise)return A.currentPromise.then((function(){return P.isCurrentUserAllowedTo(t)}));if(null!==A.cachedCapabilities)return new Promise((function(e){e(Object.keys(A.cachedCapabilities).includes(t)&&!0===A.cachedCapabilities[t])}));var e=n()({path:"/csp-plugin/v1/capabilities/current-user",method:"GET"}).then((function(e){return A.cachedCapabilities=e,A.resetCurrentPromise(),Object.keys(e).includes(t)&&!0===e[t]}));return A.currentPromise=e,e}},j=["value"];function T(){return T=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},T.apply(this,arguments)}function C(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,_x,a,i=[],_n=!0,c=!1;try{if(_x=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;_n=!1}else for(;!(_n=(r=_x.call(n)).done)&&(i.push(r.value),i.length!==e);_n=!0);}catch(t){c=!0,o=t}finally{try{if(!_n&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return k(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?k(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var L=function(t){var e=t.value,n=function(t,e){if(null==t)return{};var n,r,o=function(t,e){if(null==t)return{};var n,r,o={},a=Object.keys(t);for(r=0;r<a.length;r++)n=a[r],e.indexOf(n)>=0||(o[n]=t[n]);return o}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(r=0;r<a.length;r++)n=a[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}(t,j),r=C((0,h.useState)(!1),2),o=r[0],a=r[1],i=C((0,h.useState)(!1),2),c=i[0],l=i[1];(0,g.useEffect)((function(){P.isCurrentUserAllowedTo("csp_plugin.semantic_platform.similar_article.insert").then((function(t){l(t)}))}),[]);var u=(0,v.useSelect)((function(t){return t("core/block-editor").getSelectedBlock()}),[]);if(u&&"core/paragraph"!==u.name)return null;var s=(0,p.getTextContent)((0,p.slice)(e));return""===s?null:React.createElement(React.Fragment,null,!1===c&&null,!0===c&&React.createElement(React.Fragment,null,React.createElement(R.BlockControls,null,React.createElement(d.ToolbarGroup,null,React.createElement(d.ToolbarButton,{icon:"search",title:(0,m.__)("CSP Related posts","csp-plugin"),onClick:function(){a(!0)}}))),React.createElement(_,T({open:o,setOpen:a,selectedBlock:u,selectedText:s,value:e},n))))},I=function(){(0,p.registerFormatType)("csp-plugin/link-to-related-post",{title:"CSP Related post",tagName:"a",className:"csp-plugin-related-post-link",edit:L})},N=window.wp.editPost,F=window.wp.editor,B=function(t){var e=t.setModalOpen;return React.createElement("div",null,React.createElement("button",{className:"button button-primary csp-plugin-meta-box-action-button",onClick:function(){e(!0)}},(0,m.__)("Find links","csp-plugin")))},G=window.wp.url;function D(t){return D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},D(t)}function U(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function M(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?U(Object(n),!0).forEach((function(e){q(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function q(t,e,n){return(e=function(t){var e=function(t,e){if("object"!==D(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==D(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===D(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function z(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return $(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return i=t.done,t},e:function(t){c=!0,a=t},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw a}}}}function $(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function H(){H=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function l(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,n){return t[e]=n}}function u(t,e,n,o){var a=e&&e.prototype instanceof p?e:p,i=Object.create(a.prototype),c=new x(o||[]);return r(i,"_invoke",{value:E(t,n,c)}),i}function s(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var f={};function p(){}function d(){}function h(){}var m={};l(m,a,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(O([])));g&&g!==e&&n.call(g,a)&&(m=g);var v=h.prototype=p.prototype=Object.create(m);function b(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function o(r,a,i,c){var l=s(t[r],t,a);if("throw"!==l.type){var u=l.arg,f=u.value;return f&&"object"==D(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){o("next",t,i,c)}),(function(t){o("throw",t,i,c)})):e.resolve(f).then((function(t){u.value=t,i(u)}),(function(t){return o("throw",t,i,c)}))}c(l.arg)}var a;r(this,"_invoke",{value:function(t,n){function r(){return new e((function(e,r){o(t,n,e,r)}))}return a=a?a.then(r,r):r()}})}function E(t,e,n){var r="suspendedStart";return function(o,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw a;return{value:void 0,done:!0}}for(n.method=o,n.arg=a;;){var i=n.delegate;if(i){var c=S(i,n);if(c){if(c===f)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var l=s(t,e,n);if("normal"===l.type){if(r=n.done?"completed":"suspendedYield",l.arg===f)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r="completed",n.method="throw",n.arg=l.arg)}}}function S(t,e){var n=e.method,r=t.iterator[n];if(void 0===r)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=void 0,S(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var o=s(r,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,f;var a=o.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function _(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function R(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function x(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(_,this),this.reset(!0)}function O(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:A}}function A(){return{value:void 0,done:!0}}return d.prototype=h,r(v,"constructor",{value:h,configurable:!0}),r(h,"constructor",{value:d,configurable:!0}),d.displayName=l(h,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,l(t,c,"GeneratorFunction")),t.prototype=Object.create(v),t},t.awrap=function(t){return{__await:t}},b(w.prototype),l(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(e,n,r,o,a){void 0===a&&(a=Promise);var i=new w(u(e,n,r,o),a);return t.isGeneratorFunction(n)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},b(v),l(v,c,"Generator"),l(v,a,(function(){return this})),l(v,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},t.values=O,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(R),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return i.type="throw",i.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),l=n.call(a,"finallyLoc");if(c&&l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,f):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),R(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;R(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:O(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}function K(t,e,n,r,o,a,i){try{var c=t[a](i),l=c.value}catch(t){return void n(t)}c.done?e(l):Promise.resolve(l).then(r,o)}function Y(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var a=t.apply(e,n);function i(t){K(a,r,o,i,c,"next",t)}function c(t){K(a,r,o,i,c,"throw",t)}i(void 0)}))}}var J,Q={fetchNamedEntities:function(t){return n()({path:"/csp-plugin/v1/ner/extract",method:"POST",data:t})},fetchTagsForEntity:function(t){var e={page:1,per_page:10,context:"view",search:t.entity};return n()({path:(0,G.addQueryArgs)("/wp/v2/tags",e),method:"GET"})},getTagById:function(t){return n()({path:"/wp/v2/tags/".concat(t),method:"GET"})},createNewTagForEntity:(J=Y(H().mark((function t(e){var r;return H().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n()({path:"/wp/v2/tags",method:"POST",data:{name:e.entity}}).catch(function(){var t=Y(H().mark((function t(e){return H().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.code||"term_exists"!==e.code){t.next=4;break}return t.next=3,Q.getTagById(e.data.term_id);case 3:return t.abrupt("return",t.sent);case 4:throw e;case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 2:return r=t.sent,t.next=5,Q.addTagToCSPDictionary(r.id,e.type);case 5:return t.abrupt("return",r);case 6:case"end":return t.stop()}}),t)}))),function(_x){return J.apply(this,arguments)}),addTagToCSPDictionary:function(t,e){return n()({path:"/csp-plugin/v1/dictionary/add-entity",method:"POST",data:{tagId:t,entityType:e}})},getToInsert:function(t){var e='<a href="'.concat(t.url,'" class="csp-plugin">').concat(t.entity,"</a>");return{toInsert:e,addedLength:e.length-t.entity.length}},insertEntityLink:function(t,e,n){var r=Q.getToInsert(t),o=r.toInsert,a=r.addedLength;e=e.substring(0,t.start_char+1)+o+e.substring(t.end_char+1);var i,c=[],l=z(n);try{for(l.s();!(i=l.n()).done;){var u=i.value;u.start_char>t.start_char&&(u.start_char+=a,u.end_char+=a),u.start_char===t.start_char&&u.end_char===t.end_char&&(u.selected=!0),c.push(u)}}catch(t){l.e(t)}finally{l.f()}return{postContent:e,updatedEntities:Q.orderEntities(c)}},orderEntities:function(t){return t.sort((function(t,e){var n=parseFloat(t.score.split("%")[0]);return parseFloat(e.score.split("%")[0])-n})),t},checkAndAdaptEntityPosition:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,r=Q.getToInsert(t),o=r.addedLength;n+=o;var a=e.substring(t.start_char+1,t.end_char+1),i=a===t.entity;if(i)return{start_char:t.start_char,end_char:t.end_char};var c=Q.getEntitySurroundings(t,e,n),l=c.indexOf(t.entity);if(-1===l){var u=Q.decodeEntities(t.entity),s=c.indexOf(u);if(-1===s)return null;t.entity=u}var f=t.start_char-(n+1)+l,p=f+t.entity.length;return{start_char:f,end_char:p}},getEntitySurroundings:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15;return e.substring(t.start_char-n,t.end_char+n)},isEntityLinked:function(t,e){var n=Q.getEntitySurroundings(t,e,100).match(/(?<=<a href=".*?">)(.*?)(?=<\/a>)/g);if(null!==n&&n.length>0){var r,o=z(n);try{for(o.s();!(r=o.n()).done;)if(r.value===t.entity)return!0}catch(t){o.e(t)}finally{o.f()}}return!1},filterNotFoundEntitiesAndUpdatePositions:function(t,e){var n,r=[],o=z(t);try{for(o.s();!(n=o.n()).done;){var a=n.value,i=Q.checkAndAdaptEntityPosition(a,e,50);a.selected=Q.isEntityLinked(a,e),null!==i&&r.push(M(M({},a),i))}}catch(t){o.e(t)}finally{o.f()}return r},groupEntities:function(t){var e={};return t.forEach((function(t){void 0===e[t.type]&&(e[t.type]=[]),e[t.type].push(t)})),Object.keys(e).sort().reduce((function(t,n){return t[n]=e[n],t}),{})},getEntities:function(t){var e=t.named_entities;return null==e||""===e?[]:JSON.parse(e)},saveEntities:function(t,e,n){n(M(M({},e),{},{named_entities:JSON.stringify(Q.orderEntities(t))}))},saveOneEntity:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;null===r&&(r=Q.getEntities(e));var o,a=[],i=z(r);try{for(i.s();!(o=i.n()).done;){var c=o.value;c.start_char===t.start_char&&c.end_char===t.end_char&&(c=t),a.push(c)}}catch(t){i.e(t)}finally{i.f()}Q.saveEntities(a,e,n)},syncEntitiesWithPostContent:function(t,e){if(0===t.length)return{updatedEntities:[],warning:!1};var n=[],r=[];t.forEach((function(t){var o=Q.isEntityLinked(t,e),a=M(M({},t),{},{selected:o,selectedTag:o}),i=Q.checkAndAdaptEntityPosition(t,e,80);null===i&&r.push(t),i&&(a=M(M({},a),i)),n.push(a)}));var o=r.length>=t.length/2;return{updatedEntities:n,warning:o}},decodeEntities:function(t){var e=document.createElement("div");return t&&"string"==typeof t&&(t=(t=t.replace(/<script[^>]*>([\S\s]*?)<\/script>/gim,"")).replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gim,""),e.innerHTML=t,t=e.textContent,e.textContent=""),t}};function V(t){return V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},V(t)}function W(){W=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function l(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,n){return t[e]=n}}function u(t,e,n,o){var a=e&&e.prototype instanceof p?e:p,i=Object.create(a.prototype),c=new x(o||[]);return r(i,"_invoke",{value:E(t,n,c)}),i}function s(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var f={};function p(){}function d(){}function h(){}var m={};l(m,a,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(O([])));g&&g!==e&&n.call(g,a)&&(m=g);var v=h.prototype=p.prototype=Object.create(m);function b(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function o(r,a,i,c){var l=s(t[r],t,a);if("throw"!==l.type){var u=l.arg,f=u.value;return f&&"object"==V(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){o("next",t,i,c)}),(function(t){o("throw",t,i,c)})):e.resolve(f).then((function(t){u.value=t,i(u)}),(function(t){return o("throw",t,i,c)}))}c(l.arg)}var a;r(this,"_invoke",{value:function(t,n){function r(){return new e((function(e,r){o(t,n,e,r)}))}return a=a?a.then(r,r):r()}})}function E(t,e,n){var r="suspendedStart";return function(o,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw a;return{value:void 0,done:!0}}for(n.method=o,n.arg=a;;){var i=n.delegate;if(i){var c=S(i,n);if(c){if(c===f)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var l=s(t,e,n);if("normal"===l.type){if(r=n.done?"completed":"suspendedYield",l.arg===f)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r="completed",n.method="throw",n.arg=l.arg)}}}function S(t,e){var n=e.method,r=t.iterator[n];if(void 0===r)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=void 0,S(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var o=s(r,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,f;var a=o.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function _(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function R(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function x(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(_,this),this.reset(!0)}function O(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:A}}function A(){return{value:void 0,done:!0}}return d.prototype=h,r(v,"constructor",{value:h,configurable:!0}),r(h,"constructor",{value:d,configurable:!0}),d.displayName=l(h,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,l(t,c,"GeneratorFunction")),t.prototype=Object.create(v),t},t.awrap=function(t){return{__await:t}},b(w.prototype),l(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(e,n,r,o,a){void 0===a&&(a=Promise);var i=new w(u(e,n,r,o),a);return t.isGeneratorFunction(n)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},b(v),l(v,c,"Generator"),l(v,a,(function(){return this})),l(v,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},t.values=O,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(R),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return i.type="throw",i.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),l=n.call(a,"finallyLoc");if(c&&l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,f):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),R(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;R(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:O(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}function X(t,e,n,r,o,a,i){try{var c=t[a](i),l=c.value}catch(t){return void n(t)}c.done?e(l):Promise.resolve(l).then(r,o)}function Z(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,_x,a,i=[],_n=!0,c=!1;try{if(_x=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;_n=!1}else for(;!(_n=(r=_x.call(n)).done)&&(i.push(r.value),i.length!==e);_n=!0);}catch(t){c=!0,o=t}finally{try{if(!_n&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return tt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?tt(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var et=function(t){var e=t.entity,n=t.withType,r=void 0!==n&&n,o=t.withAction,a=void 0===o||o,i=Z((0,h.useState)(e.is_candidate?"candidate":"created"),2),c=i[0],l=i[1],u=Z((0,h.useState)(!1),2),s=u[0],f=u[1],p=function(){var t,e=(t=W().mark((function t(e){return W().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return f(!0),e.entity=Q.decodeEntities(e.entity),t.next=4,Q.createNewTagForEntity(e).then((function(){l("created"),f(!1)}));case 4:case"end":return t.stop()}}),t)})),function(){var e=this,n=arguments;return new Promise((function(r,o){var a=t.apply(e,n);function i(t){X(a,r,o,i,c,"next",t)}function c(t){X(a,r,o,i,c,"throw",t)}i(void 0)}))});return function(t){return e.apply(this,arguments)}}();return React.createElement("tr",null,React.createElement("td",null,Q.decodeEntities(e.entity)),r&&React.createElement("td",null,(0,m.__)(e.type,"csp-plugin")),React.createElement("td",null,e.score),React.createElement("td",null,e.count),a&&React.createElement("td",null,s&&React.createElement("td",null,React.createElement("span",{className:"spinner csp-plugin-spinner"})),!s&&"candidate"===c&&React.createElement(d.Button,{onClick:function(){return p(e)},icon:React.createElement(d.Icon,{icon:"tag"}),label:(0,m.__)("Add as tag","csp-plugin"),isSmall:!0,isPrimary:!0,disabled:e.selectedTag}),"created"===c&&React.createElement(d.Icon,{sx:{color:"green"},icon:"yes-alt"})))},nt=function(t){var e=t.entities,n=t.loading,r=t.error,o=t.empty,a=t.withType,i=void 0!==a&&a,c=t.withAction,l=void 0===c||c;return React.createElement("table",{className:"wp-list-table widefat fixed pages sortable "},n&&React.createElement("tr",null,React.createElement("td",null,React.createElement("div",{style:{textAlign:"center"}},React.createElement(d.Spinner,null)))),r&&React.createElement("tr",null,React.createElement("td",null,React.createElement("div",null,(0,m.__)("An error occurred while fetching the named entities","csp-plugin")))),o&&React.createElement("tr",null,React.createElement("td",null,React.createElement("div",null,(0,m.__)("No named entities found","csp-plugin")))),!n&&!r&&!o&&React.createElement(React.Fragment,null,React.createElement("thead",null,React.createElement("tr",null,React.createElement("td",{style:{width:"120px"}},(0,m.__)("Entity","csp-plugin")),i&&React.createElement("td",{style:{width:"120px"}},(0,m.__)("Type","csp-plugin")),React.createElement("td",{style:{width:"50px"}},(0,m.__)("Score","csp-plugin")),React.createElement("td",{style:{width:"50px"}},(0,m.__)("Number of occurrences","csp-plugin")),l&&React.createElement("td",{style:{width:"60px"}},(0,m.__)("Actions","csp-plugin")))),React.createElement("tbody",null,e.map((function(t){return React.createElement(et,{entity:t,withType:i,withAction:l})})))))};function rt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,_x,a,i=[],_n=!0,c=!1;try{if(_x=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;_n=!1}else for(;!(_n=(r=_x.call(n)).done)&&(i.push(r.value),i.length!==e);_n=!0);}catch(t){c=!0,o=t}finally{try{if(!_n&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return ot(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ot(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ot(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var at=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=t.filter((function(t){return t.is_candidate===e}));n&&r.sort((function(t,e){return e.score-t.score}));var o=r.map((function(t){return t.count=r.filter((function(e){return e.entity===t.entity})).length,t}));return o.filter((function(t,e,n){return n.findIndex((function(e){return e.entity===t.entity}))===e}))},it=function(t){var e=t.postContent,n=rt((0,h.useState)(!0),2),r=n[0],o=n[1],a=rt((0,h.useState)(!1),2),i=a[0],c=a[1],l=rt((0,h.useState)(null),2),u=l[0],s=l[1],f=rt((0,h.useState)(!1),2),p=f[0],y=f[1],v=rt((0,h.useState)([]),2),b=v[0],w=v[1],E=rt((0,h.useState)([]),2),S=E[0],_=E[1];return(0,g.useEffect)((function(){P.isCurrentUserAllowedTo("csp_plugin.semantic_platform.entities.add_suggested").then((function(t){y(t)})),function(t,e,n,r,o,a){t(!0),e(null),Promise.all([Q.fetchNamedEntities({content:a,matcher:"csp_smart_matcher"}),Q.fetchNamedEntities({content:a,matcher:"csp_basic_matcher"})]).then((function(t){var e=rt(t,2),n=e[0],r=n.entities,o=n.overlap,a=n.article,i=e[1].entities,c=[];return Object.values(r).forEach((function(t){return c.push(t)})),Object.values(i).forEach((function(t){0===Object.values(r).filter((function(e){return e.id===t.id})).length&&c.push(t)})),{entities:Object.values(c),overlap:o,article:a}})).then((function(e){var a=e.entities;e.overlap,e.article,0!==a.length?(n(!1),r(at(a,!0,!0)),o(at(a,!1)),t(!1)):n(!0)})).catch((function(n){console.error(n),e(n),t(!1)}))}(o,s,c,w,_,e)}),[]),React.createElement(React.Fragment,null,!0===p&&React.createElement(d.PanelBody,{title:(0,m.__)("Named entities candidates","csp-plugin"),initialOpen:!0},React.createElement(d.PanelRow,null,React.createElement(nt,{entities:b,withType:!0,loading:r,error:u,empty:i}))),React.createElement(d.PanelBody,{title:(0,m.__)("Known named entities","csp-plugin"),initialOpen:!0},React.createElement(d.PanelRow,null,React.createElement(nt,{entities:S,withAction:!1,loading:r,error:u,empty:i}))))};function ct(t,e){if(t){if("string"==typeof t)return lt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?lt(t,e):void 0}}function lt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var ut=function(t){var e,n,r=t.asTag,o=t.taxonomyElement,a=t.onChange,i=t.currentTaxonomyElements,c=(e=(0,h.useState)(i.includes(o.id)),n=2,function(t){if(Array.isArray(t))return t}(e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,_x,a,i=[],_n=!0,c=!1;try{if(_x=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;_n=!1}else for(;!(_n=(r=_x.call(n)).done)&&(i.push(r.value),i.length!==e);_n=!0);}catch(t){c=!0,o=t}finally{try{if(!_n&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return i}}(e,n)||ct(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),l=c[0],u=c[1],s={name:""};return 0!==o.parent&&(s=(0,v.useSelect)((function(t){return t("core").getEntityRecord("taxonomy","category",o.parent)}))),React.createElement(React.Fragment,null,void 0!==s&&React.createElement(React.Fragment,null,React.createElement(d.CheckboxControl,{className:"float-left",checked:l,onChange:function(t){u(t),a(o,t)}}),React.createElement("strong",null,r||""===s.name?"":s.name+" > ",o.label)))},st=function(t){var e=t.asTags,n=t.isLoading,r=t.taxonomyElements,o=t.currentPost,a=t.setCurrentTaxonomyElements,i=t.currentTaxonomyElements,c=function(t,e){var n,r=function(t){if(Array.isArray(t))return lt(t)}(n=i)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||ct(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();e?r.push(t.id):r.splice(r.indexOf(t.id),1),a(r)};return React.createElement("div",{className:"csp-plugin-modal-result-table-container"},React.createElement("table",{className:"wp-list-table widefat fixed pages sortable "},n&&React.createElement("tr",null,React.createElement("td",null,React.createElement("div",{style:{textAlign:"center"}},React.createElement(d.Spinner,null)))),o&&!n&&r.length>0?r.map((function(t){return React.createElement("tr",null,React.createElement("td",null,React.createElement(ut,{asTag:e,taxonomyElement:t,currentTaxonomyElements:i,onChange:c})))})):n?React.createElement(React.Fragment,null):React.createElement("tr",null,React.createElement("td",null,React.createElement("span",null,(0,m.__)("No result","csp-plugin"))))))};function ft(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,_x,a,i=[],_n=!0,c=!1;try{if(_x=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;_n=!1}else for(;!(_n=(r=_x.call(n)).done)&&(i.push(r.value),i.length!==e);_n=!0);}catch(t){c=!0,o=t}finally{try{if(!_n&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return i}}(t,e)||pt(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pt(t,e){if(t){if("string"==typeof t)return dt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?dt(t,e):void 0}}function dt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var ht=function(t){var e,r=t.asTags,o=t.currentPost,a=t.tags,i=t.setTags,c=t.categories,l=t.setCategories,u=ft((0,h.useState)(!0),2),s=u[0],f=u[1],p=ft((0,h.useState)([]),2),y=p[0],b=p[1];e=r?(0,v.useSelect)((function(t){return t(F.store).getEditedPostAttribute("tags")}),[]):(0,v.useSelect)((function(t){return t(F.store).getEditedPostAttribute("categories")}),[]);var w=ft(r?[a,i]:[c,l],2),E=w[0],S=w[1];return(0,g.useEffect)((function(){var t;S(function(t){if(Array.isArray(t))return dt(t)}(t=new Set(E.concat(e)))||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||pt(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}),[e]),(0,g.useEffect)((function(){(function(t,e){return n()({path:e?"/csp-plugin/v1/tag":"/csp-plugin/v1/categorize",method:"POST",data:t})})({postId:wp.data.select(F.store).getCurrentPostId(),content:o.content,introduction:""!==o.excerpt?o.excerpt:o.title,title:o.title},r).then((function(t){b(t.taxonomyElements),f(!1)})).catch((function(t){console.error(t),f(!1)}))}),[]),React.createElement(d.PanelBody,{title:(0,m.__)(r?"Tag post":"Categorize post","csp-plugin"),initialOpen:!0},React.createElement(d.PanelRow,null,React.createElement(st,{asTags:r,isLoading:s,taxonomyElements:y,currentPost:o,setCurrentTaxonomyElements:S,currentTaxonomyElements:E})))},mt=function(t){var e=t.isLoading,n=t.posts,r=t.permalinks,o=t.setPosts;return React.createElement("div",{className:"csp-plugin-modal-result-table-container"},React.createElement("table",{className:"wp-list-table widefat fixed pages sortable "},e&&React.createElement("tr",null,React.createElement("td",{style:{textAlign:"center"}},React.createElement(d.Spinner,null))),!e&&n.length>0?n.map((function(t){return React.createElement("tr",null,React.createElement("td",null,React.createElement("strong",null,React.createElement("a",{href:r[t.ID],target:"_blank"},t.post_title)),React.createElement(d.Button,{className:"float-right",onClick:function(){return e=t.ID,void o(n.filter((function(t){return t.ID!==e})));var e},variant:"primary"},(0,m.__)("Delete","csp-plugin"))))})):e?React.createElement(React.Fragment,null):React.createElement("tr",null,React.createElement("td",null,React.createElement("span",null,(0,m.__)("No result","csp-plugin"))))))};function yt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,_x,a,i=[],_n=!0,c=!1;try{if(_x=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;_n=!1}else for(;!(_n=(r=_x.call(n)).done)&&(i.push(r.value),i.length!==e);_n=!0);}catch(t){c=!0,o=t}finally{try{if(!_n&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return gt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?gt(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function gt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var vt=function(t){var e=t.currentPost,n=t.relatedPosts,r=t.setRelatedPosts,o=yt((0,h.useState)(!0),2),a=o[0],i=o[1],c=yt((0,h.useState)([]),2),l=c[0],u=c[1];return(0,g.useEffect)((function(){var t={postId:e.id,content:e.content,introduction:""!==e.excerpt?e.excerpt:e.title,title:e.title};b(t).then((function(t){r(t.posts),u(t.permalinks),i(!1)})).catch((function(t){console.error(t),i(!1)}))}),[]),React.createElement(d.PanelBody,{title:(0,m.__)("Related posts","csp-plugin"),initialOpen:!0},React.createElement(d.PanelRow,null,React.createElement(mt,{isLoading:a,posts:n,permalinks:l,setPosts:r})))};function bt(t){return function(t){if(Array.isArray(t))return St(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||Et(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,_x,a,i=[],_n=!0,c=!1;try{if(_x=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;_n=!1}else for(;!(_n=(r=_x.call(n)).done)&&(i.push(r.value),i.length!==e);_n=!0);}catch(t){c=!0,o=t}finally{try{if(!_n&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return i}}(t,e)||Et(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Et(t,e){if(t){if("string"==typeof t)return St(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?St(t,e):void 0}}function St(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var _t=function(){var t=wt((0,h.useState)(!1),2),e=t[0],r=t[1],o=wt((0,h.useState)(!1),2),i=o[0],c=o[1],l=wt((0,h.useState)(!1),2),u=l[0],s=l[1],p=(0,v.useSelect)((function(t){return t(F.store).getCurrentPost()})),y=(0,v.useSelect)((function(t){return t(F.store).getEditedPostContent("postType",p.type,p.id)}),[]),b=(0,v.useSelect)((function(t){return t(F.store)}),[]).getEditedPostAttribute,w=wt((0,h.useState)(null),2),E=w[0],S=w[1],_=wt((0,h.useState)({tagging_taxonomy:null,categorize_taxonomy:null}),2),R=_[0],x=_[1],O=wt((0,h.useState)([]),2),A=O[0],j=O[1],T=wt((0,h.useState)([]),2),C=T[0],k=T[1],L=wt((0,h.useState)([]),2),I=L[0],N=L[1],G=wt((0,h.useState)(!1),2),D=G[0],U=G[1],M=wt((0,h.useState)(!1),2),q=M[0],z=M[1],$=wt((0,h.useState)(!1),2),H=$[0],K=$[1],Y=wt((0,h.useState)(!1),2),J=Y[0],V=Y[1];(0,g.useEffect)((function(){P.isCurrentUserAllowedTo("csp_plugin.semantic_platform.category").then((function(t){U(t)})),P.isCurrentUserAllowedTo("csp_plugin.semantic_platform.tags").then((function(t){z(t)})),P.isCurrentUserAllowedTo("csp_plugin.semantic_platform.entities").then((function(t){K(t)})),P.isCurrentUserAllowedTo("csp_plugin.semantic_platform.entities").then((function(t){V(t)})),a.getSettings().then((function(t){S(t),x({tagging_taxonomy:t.tagging_wp_taxonomy,categorize_taxonomy:t.categorize_wp_taxonomy})}))}),[]);var W=function(t,e){var n={},r=e?R.tagging_taxonomy:R.categorize_taxonomy;return"post_tag"===r?r="tags":"category"===r&&(r="categories"),n[r]=t,(0,v.dispatch)("core").editEntityRecord("postType",p.type,p.id,n),Promise.resolve()},X=function(t){return(e={postId:p.id,posts:t.map((function(t){return t.ID}))},n()({path:"/csp-plugin/v1/related-posts/save-related-posts",method:"POST",data:e})).then((function(t){f.replaceRelatedPostsTableContent(t)}));var e};return React.createElement(React.Fragment,null,React.createElement(B,{setModalOpen:r}),e&&React.createElement(d.Modal,{title:(0,m.__)("Find links","csp-plugin"),onRequestClose:function(t){t.target.classList.contains("csp-plugin-add-button")||r(!1)},style:{width:"98%",paddingBottom:"64px",minHeight:"95%"}},u&&React.createElement("div",{style:{display:"flex",width:"100%",height:"90vh",justifyContent:"center",alignItems:"center"}},React.createElement("h2",null,(0,m.__)("An error occurred.","csp-plugin"))),i&&!u&&React.createElement("div",{style:{display:"flex",width:"100%",height:"90vh",justifyContent:"center",alignItems:"center"}},React.createElement(d.Spinner,{style:{height:"calc(4px * 10)",width:"calc(4px * 10)"}})),!i&&!u&&React.createElement(d.Panel,null,!0===D&&React.createElement(ht,{asTags:!1,currentPost:p,categories:A,setCategories:j,configuredTaxonomies:R}),!0===q&&React.createElement(ht,{asTags:!0,currentPost:p,tags:C,setTags:k,configuredTaxonomies:R}),!0===J&&React.createElement(vt,{currentPost:p,relatedPosts:I,setRelatedPosts:N}),!0===H&&React.createElement(it,{postContent:y,currentPost:p,settings:E})),React.createElement("div",{style:{position:"fixed",bottom:"10px",left:"10px",backgroundColor:"white"}},React.createElement(d.Button,{style:{marginRight:"1em"},variant:"secondary",onClick:function(){c(!0),setTimeout((function(){c(!1)}),1e3)}},(0,m.__)("Refresh","csp-plugin"))),React.createElement("div",{style:{position:"fixed",bottom:"10px",right:"10px",backgroundColor:"white"}},React.createElement(d.Button,{style:{marginRight:"1em"},variant:"secondary",onClick:function(){return r(!1)}},(0,m.__)("Cancel","csp-plugin")),React.createElement(d.Button,{variant:"primary",className:"csp-plugin-add-button",onClick:function(t){return c(!0),void Promise.all([W(A,!1),W(C,!0),X(I)]).then((function(){return Q.fetchNamedEntities({content:y,matcher:"csp_basic_matcher"}).then((function(t){var e=t.entities,n=(t.overlap,t.article);E&&!E.ner_only_add_as_tag&&(0,v.dispatch)(F.store).resetBlocks(wp.blocks.parse(n.text));var r=Object.values(e).map((function(t){return t.id})),o=b("tags"),a={tags:[].concat(bt(o),bt(r)).filter((function(t,e,n){return n.indexOf(t)===e}))};(0,v.dispatch)("core").editEntityRecord("postType",p.type,p.id,a)}))})).then((function(){r(!1),c(!1)})).catch((function(t){console.error(t),c(!1),s(!0)}))},disabled:i||u},(0,m.__)("Create","csp-plugin")))))},Rt=function(){return React.createElement(React.Fragment,null,React.createElement(N.PluginDocumentSettingPanel,{title:(0,m.__)("ContentSide Semantic Platform","csp-plugin")},React.createElement(_t,null)))},xt=wp.plugins.registerPlugin;a.isApiKeyValid().then((function(t){t&&wp.domReady((function(){a.isFeatureAllowed("LOOKALIKE").then((function(t){t&&I()})),xt("csp-plugin-panel",{render:Rt})}))})),window.addEventListener("load",(function(){l.bindEvents(),f.bindEvents()}))}();